{"changed":true,"filter":false,"title":"members_controller.rb","tooltip":"/app/controllers/members_controller.rb","value":"class MembersController < ApplicationController\n  before_action :set_member,       only: [:show, :edit, :update, :destroy]\n  before_action :logged_in_member, only: [:show, :edit, :update]\n  before_action :correct_member,   only: [:edit, :update]\n  before_action :admin_member,     only: [:index]\n  before_action :master_admin,     only: [:destroy]\n  # GET /members\n  # GET /members.json\n  def index\n    @members = Member.all\n    respond_to do |format|\n    format.html\n    format.csv { send_data @members.to_csv, :filename => \"export_file.csv\" }\n  end\n  end\n\n  # GET /members/1\n  # GET /members/1.json\n  def show\n    @member = Member.find(params[:id])\n  end\n\n  # GET /members/new\n  def new\n    @member = Member.new\n  end\n\n  # GET /members/1/edit\n  def edit\n  end\n\n  # POST /members\n  # POST /members.json\n  def create\n    @member = Member.new(member_params)\n    #@member.admin = 2\n    #@member.activated = true\n    if @member.admin == 2\n      @member.activated = true\n      respond_to do |format|\n      if @member.save\n        #log_in @member #Don't need because admin doesnt want to log in as them\n        format.html { redirect_to edit_member_path(@member), notice: 'Welcome to the Texas Auctioneers Association! Please Fill in your profile and check your email to activate your account.' }\n        format.json { render :show, status: :created, location: @member }\n        #@member.send_activation_email #No need, admin made account\n        #log_out \n        #redirect_to root_url\n      else\n        format.html { render :new }\n        format.json { render json: @member.errors, status: :unprocessable_entity }\n      end\n    end\n    else\n      respond_to do |format|\n        if @member.save\n          log_in @member\n          format.html { redirect_to edit_member_path(@member), notice: 'Welcome to the Texas Auctioneers Association! Please Fill in your profile and check your email to activate your account.' }\n          format.json { render :show, status: :created, location: @member }\n          @member.send_activation_email\n          #log_out \n          #redirect_to root_url\n        else\n          format.html { render :new }\n          format.json { render json: @member.errors, status: :unprocessable_entity }\n        end\n      end\n    end\n  end\n\n  # PATCH/PUT /members/1\n  # PATCH/PUT /members/1.json\n  def update\n    respond_to do |format|\n      if @member.update(member_params)\n        format.html { redirect_to @member, notice: 'Member was successfully updated.' }\n        format.json { render :show, status: :ok, location: @member }\n      else\n        format.html { render :edit }\n        format.json { render json: @member.errors, status: :unprocessable_entity }\n      end\n    end\n   \n    \n  end\n\n  # DELETE /members/1\n  # DELETE /members/1.json\n  def destroy\n      @member.destroy\n      respond_to do |format|\n        format.html { redirect_to members_url, notice: 'Member was successfully Deleted.' }\n        format.json { head :no_content }\n      end\n  \n  end\n\n  # Import CSV table\n  def import\n    Member.import(params[:file])\n    redirect_to members_url, notice: \"Products imported.\"\n  end\n  \n\n  private\n    # Use callbacks to share common setup or constraints between actions.\n    def set_member\n      @member = Member.find(params[:id])\n    end\n\n    # Never trust parameters from the scary internet, only allow the white list through.\n    def member_params\n      params.require(:member).permit(:Last_Name, :First_Name, :Company, :TX_License, :Street1, :City, :State, :Zip, :Main_Phone, :Main_Email, :Customer_Type, :Date_Joined_TAA, :Pymt_Type, :Pymt_Amt, :Pymt_Date, :Notes, :Added_to_WebBase, :PAC_Contribution, :Annual_Convention_CE_Hours, :Online_CE_Hours, :admin, :password, :password_confirmation)\n    end\n    \n   # Before filters\n\n    # Confirms a logged-in user.\n\n    def logged_in_member\n      unless logged_in?\n        store_location\n        flash[:danger] = \"Please log in.\"\n        redirect_to login_url\n      end\n    end\n    # Confirms the correct user.\n    def correct_member\n      #@mbmer = Member.find(params[:id])\n      if current_user?(@member) || current_user_master_admin?\n        true #Correct, was creating confusion \n      else\n        flash[:notice] = \"Unauthorized. Please Contact Admin\"\n        redirect_to members_url\n      end\n    end\n    #Checks if admin is a master admin, in which case they have full control\n    def master_admin\n      if !current_user_master_admin?\n        flash[:notice] = \"Unauthorized. Please Contact Admin\"\n        redirect_to login_url\n      end\n    end\n    \n    # Confirms an admin user.\n    def admin_member\n      if !logged_in?\n        flash[:notice] = \"Please log in first.\"\n        redirect_to login_url\n      else\n        if !current_user_admin?\n          flash[:notice] = \"Please log in as Admin.\"\n          redirect_to login_url\n        else\n          true\n        end\n      end\n    end\n    \nend\n","undoManager":{"mark":96,"position":100,"stack":[[{"start":{"row":39,"column":44},"end":{"row":39,"column":45},"action":"insert","lines":["a"],"id":124}],[{"start":{"row":39,"column":45},"end":{"row":39,"column":46},"action":"insert","lines":["d"],"id":125}],[{"start":{"row":39,"column":46},"end":{"row":39,"column":47},"action":"insert","lines":["m"],"id":126}],[{"start":{"row":39,"column":47},"end":{"row":39,"column":48},"action":"insert","lines":["i"],"id":127}],[{"start":{"row":39,"column":48},"end":{"row":39,"column":49},"action":"insert","lines":["n"],"id":128}],[{"start":{"row":39,"column":49},"end":{"row":39,"column":50},"action":"insert","lines":[" "],"id":129}],[{"start":{"row":39,"column":50},"end":{"row":39,"column":51},"action":"insert","lines":["d"],"id":130}],[{"start":{"row":39,"column":51},"end":{"row":39,"column":52},"action":"insert","lines":["o"],"id":131}],[{"start":{"row":39,"column":52},"end":{"row":39,"column":53},"action":"insert","lines":["e"],"id":132}],[{"start":{"row":39,"column":53},"end":{"row":39,"column":54},"action":"insert","lines":["s"],"id":133}],[{"start":{"row":39,"column":54},"end":{"row":39,"column":55},"action":"insert","lines":["n"],"id":134}],[{"start":{"row":39,"column":55},"end":{"row":39,"column":56},"action":"insert","lines":["t"],"id":135}],[{"start":{"row":39,"column":56},"end":{"row":39,"column":57},"action":"insert","lines":[" "],"id":136}],[{"start":{"row":39,"column":57},"end":{"row":39,"column":58},"action":"insert","lines":["w"],"id":137}],[{"start":{"row":39,"column":58},"end":{"row":39,"column":59},"action":"insert","lines":["a"],"id":138}],[{"start":{"row":39,"column":59},"end":{"row":39,"column":60},"action":"insert","lines":["n"],"id":139}],[{"start":{"row":39,"column":60},"end":{"row":39,"column":61},"action":"insert","lines":["t"],"id":140}],[{"start":{"row":39,"column":61},"end":{"row":39,"column":62},"action":"insert","lines":[" "],"id":141}],[{"start":{"row":39,"column":62},"end":{"row":39,"column":63},"action":"insert","lines":["t"],"id":142}],[{"start":{"row":39,"column":63},"end":{"row":39,"column":64},"action":"insert","lines":["o"],"id":143}],[{"start":{"row":39,"column":64},"end":{"row":39,"column":65},"action":"insert","lines":[" "],"id":144}],[{"start":{"row":39,"column":65},"end":{"row":39,"column":66},"action":"insert","lines":["l"],"id":145}],[{"start":{"row":39,"column":66},"end":{"row":39,"column":67},"action":"insert","lines":["o"],"id":146}],[{"start":{"row":39,"column":67},"end":{"row":39,"column":68},"action":"insert","lines":["g"],"id":147}],[{"start":{"row":39,"column":68},"end":{"row":39,"column":69},"action":"insert","lines":[" "],"id":148}],[{"start":{"row":39,"column":69},"end":{"row":39,"column":70},"action":"insert","lines":["i"],"id":149}],[{"start":{"row":39,"column":70},"end":{"row":39,"column":71},"action":"insert","lines":["n"],"id":150}],[{"start":{"row":39,"column":71},"end":{"row":39,"column":72},"action":"insert","lines":[" "],"id":151}],[{"start":{"row":39,"column":72},"end":{"row":39,"column":73},"action":"insert","lines":["a"],"id":152}],[{"start":{"row":39,"column":73},"end":{"row":39,"column":74},"action":"insert","lines":["s"],"id":153}],[{"start":{"row":39,"column":74},"end":{"row":39,"column":75},"action":"insert","lines":[" "],"id":154}],[{"start":{"row":39,"column":75},"end":{"row":39,"column":76},"action":"insert","lines":["t"],"id":155}],[{"start":{"row":39,"column":76},"end":{"row":39,"column":77},"action":"insert","lines":["h"],"id":156}],[{"start":{"row":39,"column":77},"end":{"row":39,"column":78},"action":"insert","lines":["e"],"id":157}],[{"start":{"row":39,"column":78},"end":{"row":39,"column":79},"action":"insert","lines":["m"],"id":158}],[{"start":{"row":42,"column":8},"end":{"row":42,"column":9},"action":"insert","lines":["#"],"id":159}],[{"start":{"row":42,"column":38},"end":{"row":42,"column":39},"action":"insert","lines":[" "],"id":160}],[{"start":{"row":42,"column":39},"end":{"row":42,"column":40},"action":"insert","lines":["#"],"id":161}],[{"start":{"row":42,"column":40},"end":{"row":42,"column":41},"action":"insert","lines":["N"],"id":162}],[{"start":{"row":42,"column":41},"end":{"row":42,"column":42},"action":"insert","lines":["o"],"id":163}],[{"start":{"row":42,"column":42},"end":{"row":42,"column":43},"action":"insert","lines":[" "],"id":164}],[{"start":{"row":42,"column":43},"end":{"row":42,"column":44},"action":"insert","lines":["n"],"id":165}],[{"start":{"row":42,"column":44},"end":{"row":42,"column":45},"action":"insert","lines":["e"],"id":166}],[{"start":{"row":42,"column":45},"end":{"row":42,"column":46},"action":"insert","lines":["e"],"id":167}],[{"start":{"row":42,"column":46},"end":{"row":42,"column":47},"action":"insert","lines":["d"],"id":168}],[{"start":{"row":42,"column":47},"end":{"row":42,"column":48},"action":"insert","lines":[","],"id":169}],[{"start":{"row":42,"column":48},"end":{"row":42,"column":49},"action":"insert","lines":[" "],"id":170}],[{"start":{"row":42,"column":49},"end":{"row":42,"column":50},"action":"insert","lines":["a"],"id":171}],[{"start":{"row":42,"column":50},"end":{"row":42,"column":51},"action":"insert","lines":["d"],"id":172}],[{"start":{"row":42,"column":51},"end":{"row":42,"column":52},"action":"insert","lines":["m"],"id":173}],[{"start":{"row":42,"column":52},"end":{"row":42,"column":53},"action":"insert","lines":["i"],"id":174}],[{"start":{"row":42,"column":53},"end":{"row":42,"column":54},"action":"insert","lines":["n"],"id":175}],[{"start":{"row":42,"column":54},"end":{"row":42,"column":55},"action":"insert","lines":[" "],"id":176}],[{"start":{"row":42,"column":55},"end":{"row":42,"column":56},"action":"insert","lines":["m"],"id":177}],[{"start":{"row":42,"column":56},"end":{"row":42,"column":57},"action":"insert","lines":["a"],"id":178}],[{"start":{"row":42,"column":57},"end":{"row":42,"column":58},"action":"insert","lines":["d"],"id":179}],[{"start":{"row":42,"column":58},"end":{"row":42,"column":59},"action":"insert","lines":["e"],"id":180}],[{"start":{"row":42,"column":59},"end":{"row":42,"column":60},"action":"insert","lines":[" "],"id":181}],[{"start":{"row":42,"column":60},"end":{"row":42,"column":61},"action":"insert","lines":["a"],"id":182}],[{"start":{"row":42,"column":61},"end":{"row":42,"column":62},"action":"insert","lines":["c"],"id":183}],[{"start":{"row":42,"column":62},"end":{"row":42,"column":63},"action":"insert","lines":["c"],"id":184}],[{"start":{"row":42,"column":63},"end":{"row":42,"column":64},"action":"insert","lines":["o"],"id":185}],[{"start":{"row":42,"column":64},"end":{"row":42,"column":65},"action":"insert","lines":["u"],"id":186}],[{"start":{"row":42,"column":65},"end":{"row":42,"column":66},"action":"insert","lines":["n"],"id":187}],[{"start":{"row":42,"column":66},"end":{"row":42,"column":67},"action":"insert","lines":["t"],"id":188}],[{"start":{"row":49,"column":0},"end":{"row":49,"column":7},"action":"remove","lines":["    end"],"id":189}],[{"start":{"row":48,"column":9},"end":{"row":49,"column":0},"action":"remove","lines":["",""],"id":190}],[{"start":{"row":49,"column":2},"end":{"row":49,"column":4},"action":"insert","lines":["  "],"id":191}],[{"start":{"row":48,"column":9},"end":{"row":49,"column":0},"action":"insert","lines":["",""],"id":192},{"start":{"row":49,"column":0},"end":{"row":49,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":49,"column":6},"end":{"row":49,"column":7},"action":"insert","lines":["e"],"id":193}],[{"start":{"row":49,"column":7},"end":{"row":49,"column":8},"action":"insert","lines":["n"],"id":194}],[{"start":{"row":49,"column":8},"end":{"row":49,"column":9},"action":"insert","lines":["d"],"id":195},{"start":{"row":49,"column":4},"end":{"row":49,"column":6},"action":"remove","lines":["  "]}],[{"start":{"row":63,"column":7},"end":{"row":64,"column":0},"action":"insert","lines":["",""],"id":196},{"start":{"row":64,"column":0},"end":{"row":64,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":64,"column":4},"end":{"row":64,"column":5},"action":"insert","lines":["e"],"id":197}],[{"start":{"row":64,"column":5},"end":{"row":64,"column":6},"action":"insert","lines":["n"],"id":198}],[{"start":{"row":64,"column":6},"end":{"row":64,"column":7},"action":"insert","lines":["d"],"id":199},{"start":{"row":64,"column":2},"end":{"row":64,"column":4},"action":"remove","lines":["  "]}],[{"start":{"row":64,"column":2},"end":{"row":64,"column":4},"action":"insert","lines":["  "],"id":200}],[{"start":{"row":51,"column":0},"end":{"row":51,"column":2},"action":"insert","lines":["  "],"id":201},{"start":{"row":52,"column":0},"end":{"row":52,"column":2},"action":"insert","lines":["  "]},{"start":{"row":53,"column":0},"end":{"row":53,"column":2},"action":"insert","lines":["  "]},{"start":{"row":54,"column":0},"end":{"row":54,"column":2},"action":"insert","lines":["  "]},{"start":{"row":55,"column":0},"end":{"row":55,"column":2},"action":"insert","lines":["  "]},{"start":{"row":56,"column":0},"end":{"row":56,"column":2},"action":"insert","lines":["  "]},{"start":{"row":57,"column":0},"end":{"row":57,"column":2},"action":"insert","lines":["  "]},{"start":{"row":58,"column":0},"end":{"row":58,"column":2},"action":"insert","lines":["  "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":2},"action":"insert","lines":["  "]},{"start":{"row":60,"column":0},"end":{"row":60,"column":2},"action":"insert","lines":["  "]},{"start":{"row":61,"column":0},"end":{"row":61,"column":2},"action":"insert","lines":["  "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":2},"action":"insert","lines":["  "]},{"start":{"row":63,"column":0},"end":{"row":63,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":35,"column":4},"end":{"row":35,"column":5},"action":"remove","lines":["#"],"id":202}],[{"start":{"row":35,"column":21},"end":{"row":36,"column":0},"action":"insert","lines":["",""],"id":203},{"start":{"row":36,"column":0},"end":{"row":36,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":36,"column":4},"end":{"row":36,"column":5},"action":"insert","lines":["@"],"id":204}],[{"start":{"row":36,"column":5},"end":{"row":36,"column":6},"action":"insert","lines":["m"],"id":205}],[{"start":{"row":36,"column":6},"end":{"row":36,"column":7},"action":"insert","lines":["e"],"id":206}],[{"start":{"row":36,"column":7},"end":{"row":36,"column":8},"action":"insert","lines":["m"],"id":207}],[{"start":{"row":36,"column":8},"end":{"row":36,"column":9},"action":"insert","lines":["b"],"id":208}],[{"start":{"row":36,"column":9},"end":{"row":36,"column":10},"action":"insert","lines":["e"],"id":209}],[{"start":{"row":36,"column":10},"end":{"row":36,"column":11},"action":"insert","lines":["r"],"id":210}],[{"start":{"row":36,"column":11},"end":{"row":36,"column":12},"action":"insert","lines":["."],"id":211}],[{"start":{"row":36,"column":12},"end":{"row":36,"column":13},"action":"insert","lines":["a"],"id":212}],[{"start":{"row":36,"column":12},"end":{"row":36,"column":13},"action":"remove","lines":["a"],"id":213},{"start":{"row":36,"column":12},"end":{"row":36,"column":21},"action":"insert","lines":["activated"]}],[{"start":{"row":36,"column":21},"end":{"row":36,"column":22},"action":"insert","lines":[" "],"id":214}],[{"start":{"row":36,"column":22},"end":{"row":36,"column":23},"action":"insert","lines":["="],"id":215}],[{"start":{"row":36,"column":23},"end":{"row":36,"column":24},"action":"insert","lines":[" "],"id":216}],[{"start":{"row":36,"column":24},"end":{"row":36,"column":25},"action":"insert","lines":["t"],"id":217}],[{"start":{"row":36,"column":25},"end":{"row":36,"column":26},"action":"insert","lines":["r"],"id":218}],[{"start":{"row":36,"column":26},"end":{"row":36,"column":27},"action":"insert","lines":["u"],"id":219}],[{"start":{"row":36,"column":27},"end":{"row":36,"column":28},"action":"insert","lines":["e"],"id":220}],[{"start":{"row":37,"column":25},"end":{"row":38,"column":0},"action":"insert","lines":["",""],"id":221},{"start":{"row":38,"column":0},"end":{"row":38,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":38,"column":6},"end":{"row":38,"column":30},"action":"insert","lines":["@member.activated = true"],"id":222}],[{"start":{"row":35,"column":4},"end":{"row":35,"column":5},"action":"insert","lines":["#"],"id":224}],[{"start":{"row":36,"column":4},"end":{"row":36,"column":5},"action":"insert","lines":["#"],"id":225}]]},"ace":{"folds":[],"scrolltop":308,"scrollleft":0,"selection":{"start":{"row":41,"column":18},"end":{"row":41,"column":18},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1434398205320}